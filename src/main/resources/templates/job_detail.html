<!DOCTYPE html>
<html lang="th" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head><meta charset="UTF-8"><title>รายละเอียดงาน</title></head>
<body>
  <div>
    <span sec:authorize="isAuthenticated()">
      เข้าสู่ระบบโดย: <b sec:authentication="name">user</b> |
      <form method="post" action="/logout" th:object="${_csrf}" style="display:inline">
        <input type="hidden" th:name="*{parameterName}" th:value="*{token}" />
        <button type="submit">ออกจากระบบ</button>
      </form>
    </span>
    <span sec:authorize="isAnonymous()">
      <a href="/login">เข้าสู่ระบบ</a>
    </span>
    <span sec:authorize="hasRole('TEACHER')"> | <a href="/teacher/jobs">พื้นที่อาจารย์</a></span>
    <span sec:authorize="hasRole('STUDENT')"> | <a href="/student/applications">ใบสมัครของฉัน</a></span>
    | <a href="/">หน้าแรก</a>
  </div>

  <div th:if="${job != null}">
    <h2 th:text="${job.title}">title</h2>
    <p th:text="${job.description}">desc</p>
    <h3>สมัครเข้าร่วมงาน</h3>
    <p><b>คำถามจากอาจารย์:</b> <span th:text="${job.questionPrompt}">question</span></p>

    <!-- นักศึกษาเห็นฟอร์มเฉพาะเมื่อยังไม่เคยสมัคร -->
    <div sec:authorize="hasRole('STUDENT')">
      <div th:if="${alreadyApplied}">
        <p><b>คุณส่งใบสมัครแล้ว</b></p>
      </div>
      <form th:if="${!alreadyApplied}" method="post" th:action="@{|/jobs/${job.id}/apply|}" th:object="${_csrf}">
        <input type="hidden" th:name="*{parameterName}" th:value="*{token}" />
        <div><label>ชื่อ-นามสกุล</label><br/><input type="text" name="fullName" required style="width:420px"/></div>
        <div><label>รหัสนักศึกษา</label><br/><input type="text" name="studentId" required style="width:420px"/></div>
        <div><label>อีเมล</label><br/><input type="email" name="email" required style="width:420px"/></div>
        <div><label>โทรศัพท์</label><br/><input type="text" name="phone" required style="width:420px"/></div>
        <div><label>คำตอบ</label><br/><textarea name="answerText" required style="width:420px;height:120px"></textarea></div>
        <button type="submit">ส่งใบสมัคร</button>
      </form>
    </div>

    <!-- อาจารย์ไม่สามารถสมัคร -->
    <div sec:authorize="hasRole('TEACHER')">
      <p><i>บัญชีอาจารย์ไม่สามารถสมัครงานได้</i></p>
    </div>

    <!-- ผู้ใช้ไม่ล็อกอิน -->
    <div sec:authorize="isAnonymous()">
      <p>กรุณาเข้าสู่ระบบเพื่อสมัคร</p>
    </div>
  </div>
  <div th:if="${job == null}">
    <p>ไม่พบบันทึกงาน</p>
  </div>
</body></html>
